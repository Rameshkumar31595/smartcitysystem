{% extends 'base/base.html' %}

{% block title %}Admin Dashboard - Smart City Portal{% endblock %}

{% block content %}
<div class="page-header">
  <div class="page-header-content">
    <h1 class="page-title">System Overview</h1>
    <p class="page-subtitle">Monitor and manage city services</p>
  </div>
  <div class="page-header-actions">
    <a href="{% url 'admin_issue_list' %}" class="btn btn-secondary">View All Issues</a>
  </div>
</div>

<!-- Quick Management Links -->
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="bi bi-people" style="font-size: 2rem; color: #0d6efd;"></i>
        </div>
        <h5 class="card-title">Manage Users</h5>
        <p class="card-text text-muted small">Create, edit, or delete users and manage permissions</p>
        <a href="{% url 'admin_user_list' %}" class="btn btn-sm btn-primary">Go to Users</a>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="bi bi-exclamation-circle" style="font-size: 2rem; color: #fd7e14;"></i>
        </div>
        <h5 class="card-title">Manage Issues</h5>
        <p class="card-text text-muted small">Review and update issue status and details</p>
        <a href="{% url 'admin_issue_list' %}" class="btn btn-sm btn-primary">Go to Issues</a>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="bi bi-tools" style="font-size: 2rem; color: #198754;"></i>
        </div>
        <h5 class="card-title">Manage Services</h5>
        <p class="card-text text-muted small">Add, edit, or delete city services</p>
        <a href="{% url 'service_list' %}" class="btn btn-sm btn-primary">Go to Services</a>
      </div>
    </div>
  </div>
</div>

<!-- KPI Tiles -->
<div class="row g-3">
  <div class="col-md-3">
    <div class="card kpi kpi-total">
      <div class="card-body text-center">
        <div class="text-muted">Total Issues</div>
        <div class="value">{{ total_issues }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card kpi kpi-open">
      <div class="card-body text-center">
        <div class="text-muted">Open</div>
        <div class="value">{{ open_issues }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card kpi kpi-progress">
      <div class="card-body text-center">
        <div class="text-muted">In Progress</div>
        <div class="value">{{ in_progress_issues }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card kpi kpi-resolved">
      <div class="card-body text-center">
        <div class="text-muted">Resolved</div>
        <div class="value">{{ resolved_issues }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Recent Issues Table -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card card-dark">
      <div class="card-body">
        <h5 class="card-title mb-3">Recent Issues</h5>
        <div class="table-responsive table-dark-wrap">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th scope="col">Title</th>
                <th scope="col">Category</th>
                <th scope="col">Status</th>
                <th scope="col" class="text-end">Created</th>
              </tr>
            </thead>
            <tbody>
              {% for issue in recent_issues %}
              <tr>
                <td>
                  <a href="{% url 'admin_issue_detail' issue.pk %}" class="text-decoration-none">{{ issue.title }}</a>
                  <div class="text-muted small">{{ issue.user.username }}</div>
                </td>
                <td>{{ issue.category.name }}</td>
                <td>
                  <span class="badge
                    {% if issue.status == 'OPEN' %} badge-open
                    {% elif issue.status == 'IN_PROGRESS' %} badge-progress
                    {% elif issue.status == 'RESOLVED' %} badge-resolved
                    {% else %} badge-rejected
                    {% endif %}">{{ issue.get_status_display }}</span>
                </td>
                <td class="text-end text-muted">{{ issue.created_at|date:"M d, Y g:i A" }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-muted">No issues reported yet.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
